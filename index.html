<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <title>WoodPecker</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="stylesheets/layout.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <script src="howler.js/dist/howler.js"></script>
    <script src="js/map.js"></script>
    <script src="js/modal.js"></script>
  </head>
  <body>
    <div class="overlay"></div>
    <header>
      <div class="row fluid">
        <div class="large-12 columms header">
          <div class="row no-margin">
            <div class="large-7 columns">
              <a href="#"><img class="woodpecker-logo margin-top-5" src="assets/woodpecker_logo.svg"></a>
              <a href="#"><div class="connect-bt">CONECTAR-SE</div></a>
            </div>
            <div class="large-2 float-right columns">
              <div class="info">
                <span class="white" id="term-searched"> </span>
                <span class="white" id="total"></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div class="row">
      <div class="large-12 columns">
        <div id="map" class="map"></div>
      </div>
    </div>

    <div class="row content-cta">
      <div class="large-12 columns">
        <div class="high">
          <div class="content-cta">
            <img class="cta-image" src="assets/pin_home.png">
            <h1>JUNTE-SE ÀS PESSOAS E <span class="weight-500">DESCUBRA</span> SEUS <span class="weight-500">MOMENTOS</span></h1>
          </div>
        </div>
      </div>
    </div>

    <div id="myModal" class="modal">
      <div class="modal-content text-center">
        <div class="test"></div>
        <div class="row">
          <div class="large-6 columns margin-top-30">
            <div><img class="icon" src="assets/woodpecker_icon.svg"></div>
            <div class="margin-top-20 title">
              <div>A SUA CONEXÃO</div>
              <div>COM O MUNDO!</div>
            </div>
            <div class="subtitle margin-top-20">
              <div>Insira um termo que deseja</div>
              <div>acompanhar ao lado e conecte-se</div>
            </div>
          </div>
          <div class="large-6 columns">
            <input id="hashtag1" class="input margin-bottom-10" name="hashtag[]" type="text" />

            <button id="findTweet" class="btn find margin-top-20">BUSCAR</button>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <a class="about-us" href="about_us.html">Sobre nós</a>
    </footer>

    <script>
      var sound = new Howl({
        src: ['audio/Blop-Mark_DiAngelo-79054334.mp3', 'audio/sound3.wav'],
        autoplay: true,
        loop: false,
        volume: 0.5,
        onend: function() {
          console.log('Finished!');
        }
      });

      var connectBt = document.querySelector(".connect-bt");
      var modal = document.getElementById('myModal');
      var btn = document.querySelector(".connect-bt");

      connectBt.addEventListener('click', function(){
        document.querySelector('.content-cta').style.display = 'none';
        modal.style.display = "block";
      });

      window.onclick = function(e) {
        if (e.target == modal) {
          modal.style.display = "none";
          document.querySelector('.content-cta').style.display = 'block';
        }
      }

      function addMarker(location, map) {
        var m = new google.maps.Marker({
          position: location, map: map,
          animation: google.maps.Animation.DROP
        });
      }

      var termSearched = document.getElementById('term-searched');
      var totalField = document.getElementById('total');

      function updateData(total, term) {
        termSearched.innerHTML = `Termo: ${term}`;
        totalField.innerHTML = `Total: ${total}`;
      }

      var bt = document.getElementById("findTweet");
      var header = document.getElementsByClassName("header");

      bt.addEventListener("click", function() {
        var term = document.getElementById('hashtag1').value;

        var websocket = new WebSocket('ws://localhost:1608/');

        websocket.onopen = function () {
          websocket.send(term);
        }

        var tweetsNumber = 0;
        websocket.onmessage = function (message) {
          var data = JSON.parse(message.data);
          addMarker({lat: data.lat, lng: data.lng}, map);
          tweetsNumber++;
          updateData(tweetsNumber, term);
          sound.play();
        }

        websocket.onerror = function (err) {
          console.log(err);
        }

        modal.style.display = 'none';
        connectBt.style.display = 'none';
        header[0].style.paddingBottom = '40px';
        termSearched.innerHTML = "Carregando...";
      });
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBcz06Q7WuLe5Fbqek_SDExwVQSBnGDaPY&callback=initMap"></script>
  </body>
</html>
