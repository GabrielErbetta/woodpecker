<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <title>WoodPecker</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="stylesheets/layout.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/animations.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <script src="howler.js/dist/howler.js"></script>
    <script src="js/map.js"></script>
  </head>
  <body>
    <div class="overlay"></div>
    <header>
      <div class="row fluid">
        <div class="large-12 columms header">
          <div class="row no-margin">
            <div class="large-7 columns">
              <a href="#"><img class="woodpecker-logo margin-top-5" src="assets/woodpecker_logo.svg"></a>
              <a href="#"><div class="connect-bt">CONECTAR-SE</div></a>
            </div>
            <div class="large-2 float-right columns">
              <div class="info">
                <div class="white" id="term-searched"> </div>
                <div class="white" id="total"></div>
                <div class="white btn" id="graficsBt" style="display:none">Visualizar Gráficos</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div class="row">
      <div class="large-12 columns">
        <div id="map" class="map"></div>
      </div>
    </div>

    <div class="row content-cta">
      <div class="large-12 columns">
        <div class="high">
          <div class="content-cta">
            <img class="cta-image" src="assets/pin_home.png">
            <h1>JUNTE-SE ÀS PESSOAS E <span class="weight-500">DESCUBRA</span> SEUS <span class="weight-500">MOMENTOS</span></h1>
          </div>
        </div>
      </div>
    </div>

    <div id="myModal" class="modal">
      <div class="modal-content text-center">
        <div class="test"></div>
        <div class="row">
          <div class="large-6 columns margin-top-30">
            <div><img class="icon" src="assets/woodpecker_icon.svg"></div>
            <div class="margin-top-20 title">
              <div>A SUA CONEXÃO</div>
              <div>COM O MUNDO!</div>
            </div>
            <div class="subtitle margin-top-20">
              <div>Insira um termo que deseja</div>
              <div>acompanhar ao lado e conecte-se</div>
            </div>
          </div>
          <div class="large-6 columns">
            <input id="hashtag1" class="input margin-bottom-10" name="hashtag[]" type="text" />

            <button id="findTweet" class="btn find margin-top-20">BUSCAR</button>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <a class="about-us" href="about_us.html">Sobre nós</a>
    </footer>

    <script>

      var sound = new Howl({
        src: ['audio/Blop-Mark_DiAngelo-79054334.mp3', 'audio/sound3.wav'],
        autoplay: true,
        loop: false,
        volume: 0.5,
        onend: function() {
          console.log('Finished!');
        }
      });

      var connectBt = document.querySelector(".connect-bt");
      var modal = document.getElementById('myModal');
      var btn = document.querySelector(".connect-bt");
      var graficsBt = document.getElementById('graficsBt');
      var termSearched = document.getElementById('term-searched');
      var totalField = document.getElementById('total');
      var bt = document.getElementById("findTweet");
      var header = document.getElementsByClassName("header");
      var pin_icon = {
        url: `data:image/svg+xml;utf-8,
              <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
                <defs>
                  <filter id="purple-glow" x="-5000%" y="-5000%" width="10000%" height="10000%">
                          <feComposite in="flood" result="mask" in2="SourceGraphic" operator="in"></feComposite>
                          <feMorphology in="mask" result="dilated" operator="dilate" radius="2"></feMorphology>
                          <feGaussianBlur in="dilated" result="blurred" stdDeviation="5"></feGaussianBlur>
                          <feMerge>
                              <feMergeNode in="blurred"></feMergeNode>
                              <feMergeNode in="SourceGraphic"></feMergeNode>
                          </feMerge>
                      </filter>
                </defs>
                 <style type="text/css">
                  .st0{fill:#342926;}
                  .st1{fill:#8A191D;}
                  .st2{fill:#F5F5F7;}
                  .st3{opacity:0.36;}
                  .st4{fill:#565057;}
                  .st5{fill:#4F4649;}
                  .st6{fill:#F6E8D3;}
                  .st7{fill:#DFD4CB;}
                  .st8{fill:#4D434E;}
                  .st9{fill:#423939;}
                  .st10{opacity:0.36;fill:#FAF6F7;}
                  .st11{fill:#C0251B;}
                  .st12{fill:#3E2828;}
                  .st13{fill:#6C191C;}
                  .st14{fill:#A41D1B;}
                  .st15{fill:#B59A83;}
                  .st16{fill:#111014;}
                  .st17{fill:#791A1D;}</style>
                 <g>
                  <title>Layer 1</title>
                  <ellipse fill="#000000" stroke-width="null" stroke-dasharray="null" stroke-linejoin="null" stroke-linecap="null" cx="100.20343" cy="124.69001" rx="13.64036" ry="3.31483" opacity="0.8" id="svg_4" class="animate-out2" stroke="#000000"/>
                  <ellipse fill="#7fff00" stroke-width="null" stroke-dasharray="null" stroke-linejoin="null" stroke-linecap="null" cx="100.20343" cy="124.69001" rx="9.69843" ry="2.35688" id="svg_3" class="animate-out" fill-opacity="0" opacity="0.8" stroke="#000000"/>
                  <path d="m100.1692,125.00875c-0.65107,0 -1.30214,-0.32553 -1.70001,-0.83192l0,0l-12.65968,-17.79589l-0.47021,-0.65107c-2.24257,-3.14684 -3.4362,-6.80006 -3.4362,-10.63414c0,-10.01923 8.21071,-18.19377 18.26612,-18.19377c10.0554,0 18.26612,8.17454 18.26612,18.19377c0,3.83408 -1.19363,7.4873 -3.4362,10.63414l-0.6149,0.83192l-12.47883,17.57888l0,0c-0.43405,0.54256 -1.08511,0.86809 -1.73619,0.86809l0,0l0,0l-0.00002,-0.00001zm-0.65107,-1.62767c0.14468,0.21703 0.39787,0.32553 0.65107,0.32553c0.25319,0 0.50639,-0.10851 0.65107,-0.32553l12.47883,-17.57888l0.6149,-0.86809c2.09789,-2.89364 3.21917,-6.29367 3.21917,-9.83838c0,-9.33199 -7.59581,-16.89164 -16.96397,-16.89164c-9.33199,0 -16.96397,7.59581 -16.96397,16.89164c0,3.54472 1.12129,6.94474 3.18301,9.83838l0.47021,0.65107l12.65968,17.79589l0,0.00001zm0.65107,-21.77465c-3.58088,0 -6.51069,-2.92981 -6.51069,-6.51069c0,-3.58088 2.92981,-6.51069 6.51069,-6.51069c3.58088,0 6.51069,2.92981 6.51069,6.51069c0,3.58088 -2.92981,6.51069 -6.51069,6.51069zm0,-11.68308c-2.89364,0 -5.20856,2.31491 -5.20856,5.20856c0,2.85747 2.35109,5.20856 5.20856,5.20856c2.89364,0 5.20856,-2.31491 5.20856,-5.20856c0,-2.89364 -2.35109,-5.20856 -5.20856,-5.20856z" id="svg_1" filter="url(#purple-glow)" fill="#A677E6" class="grow" stroke="null"/>
                 </g>
              </svg>`
      }

      connectBt.addEventListener('click', function(){
        document.querySelector('.content-cta').style.display = 'none';
        modal.style.display = "block";
      });

      window.onclick = function(e) {
        if (e.target == modal) {
          modal.style.display = "none";
          document.querySelector('.content-cta').style.display = 'block';
        }
      }

      function addMarker(location, map) {

        var myOverlay = new google.maps.OverlayView();
        myOverlay.draw = function(){
          console.log(this.getPanes());
          this.getPanes().markerLayer.id='markerlayer'
        };
        myOverlay.setMap(map);

        var m = new google.maps.Marker({
          position: location, map: map,
          icon: pin_icon,
          optimized: false
        });
      }

      function updateData(total, term) {
        termSearched.innerHTML = `Termo: ${term}`;
        totalField.innerHTML = `Total: ${total}`;
      }

      bt.addEventListener("click", function() {
        var term = document.getElementById('hashtag1').value;
        document.querySelector(".gm-style-pbc").classList.remove("darken");
        var websocket = new WebSocket('ws://localhost:1608/');

        websocket.onopen = function () {
          websocket.send(term);
        }

        var tweetsNumber = 0;
        websocket.onmessage = function(message) {
          var data = JSON.parse(message.data);
          addMarker({lat: data.lat, lng: data.lng}, map);
          tweetsNumber++;
          updateData(tweetsNumber, term);
          sound.play();
        }

        websocket.onerror = function (err) {
          console.log(err);
        }

        modal.style.display = 'none';
        graficsBt.style.display = 'block';
        connectBt.style.display = 'none';
        header[0].style.paddingBottom = '25px';
        termSearched.innerHTML = "Carregando...";
      });

      graficsBt.addEventListener('click', () => window.location.href = `graficos.html?q=${document.getElementById('hashtag1').value}`);


    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBcz06Q7WuLe5Fbqek_SDExwVQSBnGDaPY&callback=initMap"></script>
  </body>
</html>
